<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Post Details</title>
</head>
<body>
<h1 th:text="${post.title}"></h1>
<!-- <p><strong>Author:</strong> <span th:text="${post.user.nickname}"></span></p> -->
<p><strong>Content:</strong> <span th:text="${post.content}"></span></p>

<h2>Add a comment</h2>
<form th:action="@{/saveComment}" method="post">
    <input type="hidden" th:value="${post.id}" name="postId" />
    <textarea name="content" required></textarea>
    <button type="submit">Submit</button>
</form>

<h2>Comments</h2>
<div th:each="comment : ${comments}" th:if="${comment.parent == null}">
    <p><strong>Author:</strong> <span th:text="${comment.user.nickname}"></span></p>
    <p th:text="${comment.content}"></p>
    <!-- Add a reply button here -->
    <button class="reply-button">Reply</button>

    <!-- Add a reply form here -->
    <div class="reply-form" style="display: none;">
        <h3>Reply</h3>
        <form th:action="@{/saveComment}" method="post">
            <input type="hidden" th:value="${post.id}" name="postId" />
            <input type="hidden" th:value="${comment.id}" name="parentCommentId" />
            <textarea name="content" required></textarea>
            <button type="submit">Submit</button>
        </form>
    </div>
    <div th:fragment="commentTree(comment)"th:unless="${#lists.isEmpty(comment.replies)}" >
        <div th:each="child : ${comment.replies}" th:inline="text">
            <p th:text="${child.user.nickname}"></p>
            <p th:text="${child.content}"></p>
            <div th:replace="~{this::commentTree(${child})}"></div>
        </div>
        <!-- Add a reply button here -->
        <button class="reply-button">Reply</button>

        <!-- Add a reply form here -->
        <div class="reply-form" style="display: none;">
            <h3>Reply</h3>
            <form th:action="@{/saveComment}" method="post">
                <input type="hidden" th:value="${post.id}" name="postId" />
                <input type="hidden" th:value="${comment.id}" name="parentCommentId" />
                <textarea name="content" required></textarea>
                <button type="submit">Submit</button>
            </form>
        </div>

    </div>
</div>


<script>
    document.querySelectorAll('.reply-button').forEach(function(button) {
        button.addEventListener('click', function() {
            var form = this.nextElementSibling;
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        });
    });
</script>
</body>
</html>